From 83e2593d8ba530561b56d113b3ea3447c000e56f Mon Sep 17 00:00:00 2001
From: pelle <pelle@pelle.io>
Date: Thu, 16 Oct 2014 09:46:50 +0200
Subject: [PATCH 1/3] remove references via reference control

---
 .../dictionary/controls/ReferenceControl.java        | 20 ++++++++++++--------
 .../io/pelle/mango/demo/server/DemoClientTest.java   |  7 +++++++
 2 files changed, 19 insertions(+), 8 deletions(-)

diff --git a/mango-client-web/src/io/pelle/mango/client/web/modules/dictionary/controls/ReferenceControl.java b/mango-client-web/src/io/pelle/mango/client/web/modules/dictionary/controls/ReferenceControl.java
index 21cace0..a43f547 100644
--- a/mango-client-web/src/io/pelle/mango/client/web/modules/dictionary/controls/ReferenceControl.java
+++ b/mango-client-web/src/io/pelle/mango/client/web/modules/dictionary/controls/ReferenceControl.java
@@ -66,15 +66,19 @@ public class ReferenceControl<VOTYPE extends IBaseVO> extends BaseDictionaryCont
 	@Override
 	public void endEdit() {
 
-		DictionaryUtil.getEntitiesByDictionaryLabel(getModel(), valueString, new BaseErrorAsyncCallback<List<VOTYPE>>() {
-
-			@Override
-			public void onSuccess(List<VOTYPE> result) {
-				if (result.size() == 1) {
-					setValue(result.get(0));
+		if (valueString != null && !valueString.trim().isEmpty()) {
+			DictionaryUtil.getEntitiesByDictionaryLabel(getModel(), valueString, new BaseErrorAsyncCallback<List<VOTYPE>>() {
+
+				@Override
+				public void onSuccess(List<VOTYPE> result) {
+					if (result.size() == 1) {
+						setValue(result.get(0));
+					}
 				}
-			}
-		});
+			});
+		} else {
+			setValue(null);
+		}
 	}
 
 	@Override
diff --git a/mango-demo-server/test/io/pelle/mango/demo/server/DemoClientTest.java b/mango-demo-server/test/io/pelle/mango/demo/server/DemoClientTest.java
index 6199c3a..e1c9b3e 100644
--- a/mango-demo-server/test/io/pelle/mango/demo/server/DemoClientTest.java
+++ b/mango-demo-server/test/io/pelle/mango/demo/server/DemoClientTest.java
@@ -112,6 +112,13 @@ public class DemoClientTest extends BaseDemoTest {
 		referenceControl1.endEdit();
 		search1.execute();
 		search1.assertSearchResults(1);
+		
+		// remove reference
+		referenceControl1.parseValue("");
+		referenceControl1.endEdit();
+		search1.execute();
+		search1.assertSearchResults(2);
+
 		// assertEquals("abc",
 		// search.getResultRow(0).getVO().getStringDatatype1());
 
-- 
1.9.2.msysgit.0

